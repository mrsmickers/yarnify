import { requestURL, requestHeaders, responseJSON } from '@xsai/shared';

const generateTranscription = async (options) => {
  const body = new FormData();
  body.append("model", options.model);
  body.append("file", options.file, options.fileName);
  options.language != null && body.append("language", options.language);
  options.prompt != null && body.append("prompt", options.prompt);
  options.temperature != null && body.append("temperature", options.temperature);
  return (options.fetch ?? globalThis.fetch)(requestURL("audio/transcriptions", options.baseURL), {
    body,
    headers: requestHeaders(options.headers, options.apiKey),
    method: "POST",
    signal: options.abortSignal
  }).then(responseJSON).then(({ text }) => ({ text: text.trim() }));
};

export { generateTranscription };
